\documentclass[12pt]{article}
\usepackage{amsmath, amssymb, amsthm, tikz, pgfplots}
\usepackage{geometry, enumitem, mdframed, array, xcolor}
\usepackage{algorithm2e}
\geometry{margin=1in}

% Custom environments
\newtheorem{definition}{Definition}
\newtheorem{theorem}{Theorem}
\newtheorem{method}{Method}
\newtheorem{example}{Example}
\newmdenv[linecolor=blue,linewidth=2pt]{keypoint}
\newmdenv[linecolor=red,linewidth=2pt]{warning}
\newmdenv[linecolor=green,linewidth=2pt]{insight}
\newmdenv[linecolor=purple,linewidth=2pt]{examtip}
\newmdenv[linecolor=orange,linewidth=2pt]{stability}

\title{Lesson 50: Numerical Methods for ODEs}
\author{ODE 1 - Prof. Adi Ditkowski}
\date{}

\begin{document}
\maketitle

\section{Introduction to Numerical Methods}

\begin{definition}[Numerical Solution]
A numerical solution to the IVP $y' = f(x,y)$, $y(x$_{0}$) = y$_{0}$$ is a sequence of approximations:
$$(x$_{0}$, y$_{0}$), (x$_{1}$, y$_{1}$), \ldots, (x$_{n}$, y$_{n}$)$$
where $y$_{i}$ \approx y(x$_{i}$)$ and $x_{i+1} = x$_{i}$ + h$ (step size).
\end{definition}

\begin{keypoint}
Numerical methods trade analytical exactness for computational practicality, providing approximate solutions at discrete points.
\end{keypoint}

\section{Euler's Method}

\begin{method}[Forward Euler]
$$y_{n+1} = y$_{n}$ + hf(x$_{n}$, y$_{n}$)$$
\begin{itemize}
\item Order: 1
\item Local truncation error: $O(h$^{2}$)$
\item Global error: $O(h)$
\item Stability: Conditionally stable
\item Function evaluations per step: 1
\end{itemize}
\end{method}

\begin{insight}
Euler's method is the Taylor series $y(x+h) \approx y(x) + hy'(x)$ truncated after the linear term.
\end{insight}

\section{Runge-Kutta Methods}

\subsection{Second-Order Methods}

\begin{method}[Improved Euler (Heun's Method)]
\begin{align}
k_{1} &= f(x_{n}, y_{n}) \\
k_{2} &= f(x_{n} + h, y_{n} + hk_{1}) \\
y_{n+1} &= y_{n} + \frac{h}{2}(k_{1} + k_{2})
\end{align}
\end{method}

\begin{method}[Midpoint Method (RK2)]
\begin{align}
k_{1} &= f(x_{n}, y_{n}) \\
k_{2} &= f(x_{n} + \frac{h}{2}, y_{n} + \frac{h}{2}k_{1}) \\
y_{n+1} &= y_{n} + hk_{2}
\end{align}
\end{method}

\subsection{Fourth-Order Runge-Kutta (RK4)}

\begin{method}[Classical RK4]
\begin{align}
k_{1} &= f(x_{n}, y_{n}) \\
k_{2} &= f(x_{n} + \frac{h}{2}, y_{n} + \frac{h}{2}k_{1}) \\
k_{3} &= f(x_{n} + \frac{h}{2}, y_{n} + \frac{h}{2}k_{2}) \\
k_{4} &= f(x_{n} + h, y_{n} + hk_{3}) \\
y_{n+1} &= y_{n} + \frac{h}{6}(k_{1} + 2k_{2} + 2k_{3} + k_{4})
\end{align}
\end{method}

\begin{examtip}
Remember RK4 weights as "1-2-2-1, divide by 6". The middle points get double weight!
\end{examtip}

\section{Error Analysis}

\begin{definition}[Error Types]
\begin{itemize}
\item \textbf{Local truncation error}: Error in one step, assuming previous value exact
\item \textbf{Global error}: Accumulated error over all steps
\item \textbf{Round-off error}: Due to finite precision arithmetic
\end{itemize}
\end{definition}

\begin{theorem}[Error Orders]
\begin{center}
\begin{tabular}{|l|c|c|c|}
\hline
\textbf{Method} & \textbf{Order} & \textbf{Local Error} & \textbf{Global Error} \\
\hline
Euler & 1 & $O(h$^{2}$)$ & $O(h)$ \\
Improved Euler & 2 & $O(h$^{3}$)$ & $O(h$^{2}$)$ \\
RK2 & 2 & $O(h$^{3}$)$ & $O(h$^{2}$)$ \\
RK4 & 4 & $O(h$^{5}$)$ & $O(h$^{4}$)$ \\
\hline
\end{tabular}
\end{center}
\end{theorem}

\section{Stability Analysis}

\begin{stability}
For the test equation $y' = \lambda y$ with $\lambda \in \mathbb{C}$:

\textbf{Euler's Method:}
$$y_{n+1} = (1 + h\lambda)y$_{n}$$$
Stable if $|1 + h\lambda| < 1$

\textbf{RK4:}
$$y_{n+1} = \left(1 + h\lambda + \frac{(h\lambda)$^{2}$}{2} + \frac{(h\lambda)$^{3}$}{6} + \frac{(h\lambda)$^{4}$}{24}\right)y$_{n}$$$
Stable if $|R(h\lambda)| < 1$ where $R$ is the stability function.
\end{stability}

\begin{definition}[Stiff Equations]
An ODE is \textbf{stiff} if:
\begin{itemize}
\item Solutions have components with vastly different time scales
\item Explicit methods require extremely small steps for stability
\item The problem has large negative eigenvalues (for systems)
\end{itemize}
\end{definition}

\begin{warning}
For stiff problems, explicit methods become impractical. Use implicit methods like Backward Euler:
$$y_{n+1} = y$_{n}$ + hf(x_{n+1}, y_{n+1})$$
\end{warning}

\section{Algorithm Comparison}

\begin{algorithm}[H]
\SetAlgoLined
\KwIn{$f(x,y)$, $x$_{0}$$, $y$_{0}$$, $h$, $N$ steps}
\KwOut{Numerical solution $(x$_{i}$, y$_{i}$)$}
$x \leftarrow x$_{0}$$; $y \leftarrow y$_{0}$$\;
\For{$i = 0$ to $N-1$}{
    \Switch{Method}{
        \Case{Euler}{
            $y \leftarrow y + hf(x,y)$\;
        }
        \Case{RK4}{
            $k$_{1}$ \leftarrow f(x,y)$\;
            $k$_{2}$ \leftarrow f(x+h/2, y+hk$_{1}$/2)$\;
            $k$_{3}$ \leftarrow f(x+h/2, y+hk$_{2}$/2)$\;
            $k$_{4}$ \leftarrow f(x+h, y+hk$_{3}$)$\;
            $y \leftarrow y + h(k$_{1}$+2k$_{2}$+2k$_{3}$+k$_{4}$)/6$\;
        }
    }
    $x \leftarrow x + h$\;
    Store $(x,y)$\;
}
\caption{General Numerical ODE Solver}
\end{algorithm}

\section{Practical Considerations}

\subsection{Step Size Selection}

\begin{keypoint}
Optimal step size balances:
\begin{itemize}
\item Truncation error (decreases with smaller $h$)
\item Round-off error (increases with more steps)
\item Computational cost (increases with smaller $h$)
\end{itemize}
\end{keypoint}

\subsection{Adaptive Step Size}

\begin{insight}
Modern solvers adjust $h$ dynamically:
\begin{itemize}
\item Estimate error using two different methods
\item Decrease $h$ if error too large
\item Increase $h$ if error very small
\item Maintain error within tolerance
\end{itemize}
\end{insight}

\section{Systems of ODEs}

For the system $\mathbf{y}' = \mathbf{f}(x, \mathbf{y})$:

\begin{method}[Vector RK4]
\begin{align}
\mathbf{k}_{1} &= \mathbf{f}(x_{n}, \mathbf{y}_{n}) \\
\mathbf{k}_{2} &= \mathbf{f}(x_{n} + \frac{h}{2}, \mathbf{y}_{n} + \frac{h}{2}\mathbf{k}_{1}) \\
\mathbf{k}_{3} &= \mathbf{f}(x_{n} + \frac{h}{2}, \mathbf{y}_{n} + \frac{h}{2}\mathbf{k}_{2}) \\
\mathbf{k}_{4} &= \mathbf{f}(x_{n} + h, \mathbf{y}_{n} + h\mathbf{k}_{3}) \\
\mathbf{y}_{n+1} &= \mathbf{y}_{n} + \frac{h}{6}(\mathbf{k}_{1} + 2\mathbf{k}_{2} + 2\mathbf{k}_{3} + \mathbf{k}_{4})
\end{align}
\end{method}

\section{Exam Strategy}

\begin{examtip}
Common exam questions and point distribution:
\begin{itemize}
\item Apply Euler's method for 2-3 steps (3-4 pts)
\item Apply RK4 for one step (4-5 pts)
\item Compare methods' accuracy (2-3 pts)
\item Discuss stability for given $\lambda$ (2-3 pts)
\item Identify if equation is stiff (1-2 pts)
\end{itemize}
\end{examtip}

\begin{warning}
Common errors:
\begin{itemize}
\item Using $y$_{n}$$ instead of $y$_{n}$ + k$_{1}$/2$ in RK4's $k$_{2}$$
\item Forgetting to update $x$_{n}$$ when computing $k$_{i}$$
\item Wrong RK4 weights (not 1-2-2-1)
\item Confusing order with number of function evaluations
\end{itemize}
\end{warning}

\end{document}