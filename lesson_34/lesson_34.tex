\documentclass[12pt]{article}
\usepackage{amsmath, amssymb, amsthm, tikz, pgfplots}
\usepackage{geometry, enumitem, mdframed, array, xcolor}
\usepackage{nicematrix, systeme}
\geometry{margin=1in}

% Custom environments
\newtheorem{definition}{Definition}
\newtheorem{theorem}{Theorem}
\newtheorem{method}{Method}
\newtheorem{example}{Example}
\newmdenv[linecolor=blue,linewidth=2pt]{keypoint}
\newmdenv[linecolor=red,linewidth=2pt]{warning}
\newmdenv[linecolor=green,linewidth=2pt]{insight}
\newmdenv[linecolor=purple,linewidth=2pt]{examtip}
\newmdenv[linecolor=orange,linewidth=2pt]{variation}

\title{ODE Lesson 34: Variation of Parameters for Systems}
\author{ODE 1 - Prof. Adi Ditkowski}
\date{}

\begin{document}
\maketitle

\section{Non-homogeneous Linear Systems}

\begin{definition}[Non-homogeneous System]
A non-homogeneous system of linear ODEs has the form:
\[\mathbf{x}'(t) = A(t)\mathbf{x}(t) + \mathbf{f}(t)\]
where $A(t)$ is an $n \times n$ matrix and $\mathbf{f}(t)$ is the forcing term.
\end{definition}

\begin{theorem}[General Solution Structure]
The general solution to the non-homogeneous system is:
\[\mathbf{x}(t) = \mathbf{x}_{h}(t) + \mathbf{x}_{p}(t)\]
where $\mathbf{x}_{h}$ is the general solution to the homogeneous system and $\mathbf{x}_{p}$ is any particular solution.
\end{theorem}

\section{Variation of Parameters Method}

\begin{variation}
\textbf{The Fundamental Formula:}
Given a fundamental matrix $\Phi(t)$ for the homogeneous system $\mathbf{x}' = A\mathbf{x}$, the particular solution is:
\[\mathbf{x}_{p}(t) = \Phi(t)\int \Phi^{-1}(s)\mathbf{f}(s)\,ds\]
\end{variation}

\begin{method}[Step-by-Step Procedure]
\begin{enumerate}
\item \textbf{Find the fundamental matrix} $\Phi(t)$ for $\mathbf{x}' = A\mathbf{x}$
   \begin{itemize}
   \item For constant $A: \Phi(t) = $e^{At}$
   \item Columns of \Phi are linearly independent solutions
   \end{itemize}

\item \textbf{Compute the inverse} $\Phi^{-1}(t)$
   \begin{itemize}
   \item For constant $A: \Phi^{-1}(t) = $e^{-At}$
   \item Use Wronskian: W(t) = \det(\Phi(t)) = $e^{\int \text{tr}$(A)\,dt}
   \end{itemize}

\item \textbf{Form the product} $\Phi^{-1}(s)\mathbf{f}(s)$

\item \textbf{Integrate} component-wise: $\mathbf{v}(t) = \int \Phi^{-1}(s)\mathbf{f}(s)\,ds$

\item \textbf{Multiply} to get particular solution: $\mathbf{x}_{p}(t) = \Phi(t)\mathbf{v}(t)$
\end{enumerate}
\end{method}

\section{Constant Coefficient Case}

\begin{keypoint}
\textbf{Convolution Formula:}
For constant matrix $A with \Phi(t) = $e^{At}$:
\[\mathbf{x}_{p}(t) = \int_{0}^t e^{A(t-s)}\mathbf{f}(s)\,ds\]
This represents the superposition of impulse responses!
\end{keypoint}

\begin{example}[2$\times$2 System with Exponential Forcing]
Solve \mathbf{x}' = \begin{pmatrix} 1 & 2 \\ 0 & 3 \end{pmatrix}\mathbf{x} + \begin{pmatrix} $e^{4t}$ \\ 0 \end{pmatrix}

\textbf{Solution:}
\begin{enumerate}
\item \textbf{Find eigenvalues and eigenvectors:}
\begin{itemize}
\item $\lambda_{1} = 1$: $\mathbf{v}_{1} = \begin{pmatrix} 1 \\ 0 \end{pmatrix}$
\item $\lambda_{2} = 3$: \mathbf{v}_{2} = \begin{pmatrix} 1 \\ 1 \end{pmatrix}
\end{itemize}

\item \textbf{Fundamental matrix:}
\[\Phi(t) = \begin{pmatrix} $e^{t}$ & $e^{3t}$ \\ 0 & $e^{3t}$ \end{pmatrix}\]

\item \textbf{Inverse fundamental matrix:}
\[\Phi^{-1}(t) = \begin{pmatrix} $e^{-t}$ & -$e^{-t}$ \\ 0 & $e^{-3t}$ \end{pmatrix}\]

\item \textbf{Compute $\Phi^{-1}(s)\mathbf{f}(s):}
\[\Phi^{-1}(s)\mathbf{f}(s) = \begin{pmatrix} $e^{-s}$ & -$e^{-s}$ \\ 0 & $e^{-3s}$ \end{pmatrix}\begin{pmatrix} $e^{4s}$ \\ 0 \end{pmatrix} = \begin{pmatrix} $e^{3s}$ \\ 0 \end{pmatrix}\]

\item \textbf{Integrate:}
\[\mathbf{v}(t) = \int_{0}^t \begin{pmatrix} $e^{3s}$ \\ 0 \end{pmatrix}ds = \begin{pmatrix} \frac{1}{3}($e^{3t}$ - 1) \\ 0 \end{pmatrix}\]

\item \textbf{Particular solution:}
\[\mathbf{x}_{p}(t) = \begin{pmatrix} $e^{t}$ & $e^{3t}$ \\ 0 & $e^{3t}$ \end{pmatrix}\begin{pmatrix} \frac{1}{3}($e^{3t}$ - 1) \\ 0 \end{pmatrix} = \begin{pmatrix} \frac{1}{3}$e^{t}$(e^{3t} - 1) \\ 0 \end{pmatrix} = \begin{pmatrix} \frac{1}{3}($e^{4t}$ - $e^{t}$) \\ 0 \end{pmatrix}\]
\end{enumerate}
\end{example}

\begin{example}[System with Trigonometric Forcing]
Solve \mathbf{x}' = \begin{pmatrix} 0 & 1 \\ -1 & 0 \end{pmatrix}\mathbf{x} + \begin{pmatrix} \cos(2t) \\ 0 \end{pmatrix}$

\textbf{Solution:}
The fundamental matrix is (from complex eigenvalues $\pm i$):
\[\Phi(t) = \begin{pmatrix} \cos t & \sin t \\ -\sin t & \cos t \end{pmatrix}, \quad \Phi^{-1}(t) = \begin{pmatrix} \cos t & -\sin t \\ \sin t & \cos t \end{pmatrix}\]

Computing:
\[\Phi^{-1}(s)\mathbf{f}(s) = \begin{pmatrix} \cos s & -\sin s \\ \sin s & \cos s \end{pmatrix}\begin{pmatrix} \cos(2s) \\ 0 \end{pmatrix} = \begin{pmatrix} \cos s \cos(2s) \\ \sin s \cos(2s) \end{pmatrix}\]

Using the identity $\cos s \cos(2s) = \frac{1}{2}[\cos(s) + \cos(3s)]$:
\[\mathbf{v}(t) = \int_{0}^t \begin{pmatrix} \frac{1}{2}[\cos(s) + \cos(3s)] \\ \frac{1}{2}[\sin(s)\cos(2s)] \end{pmatrix}ds\]

After integration and multiplication by $\Phi(t)$, we get the particular solution.
\end{example}

\section{Special Cases and Shortcuts}

\begin{insight}
\textbf{Undetermined Coefficients Approach:}
For $\mathbf{x}' = A\mathbf{x} + \mathbf{f}(t)$ where \mathbf{f}(t) = e^{\alpha t}\mathbf{b}:
\begin{itemize}
\item If $\alpha$ is not an eigenvalue: Try \mathbf{x}_{p} = e^{\alpha t}\mathbf{c}
\item Substitute to get: $(\alpha I - A)\mathbf{c} = \mathbf{b}$
\item Solution: $\mathbf{c} = (\alpha I - A)^{-1}\mathbf{b}$
\end{itemize}
\end{insight}

\begin{warning}
\textbf{Common Errors:}
\begin{itemize}
\item Using $\Phi(t)$ instead of $\Phi^{-1}(t)$ in the integral
\item Wrong order of matrix multiplication
\item Forgetting integration constants (use definite integrals!)
\item Not verifying the particular solution
\item Confusion between $\Phi(t-s)$ and $\Phi(t)\Phi^{-1}(s)
\end{itemize}
\end{warning}

\section{Fundamental Solution and Green's Matrix}

\begin{definition}[Green's Matrix]
The Green's matrix (or kernel) for the system is:
\[G(t,s) = \begin{cases}
\Phi(t)\Phi^{-1}(s) & \text{if } t \geq s \\
0 & \text{if } t < s
\end{cases}\]
For constant coefficients: G(t,s) = $e^{A(t-s)}$ for t \geq s.
\end{definition}

\begin{theorem}[Solution via Green's Matrix]
The particular solution with zero initial conditions is:
\[\mathbf{x}_{p}(t) = \int_{0}^t G(t,s)\mathbf{f}(s)\,ds\]
\end{theorem}

\begin{examtip}
Prof. Ditkowski's typical problems:
\begin{itemize}
\item 2\times2 systems with exponential forcing
\item Systems where $\Phi(t)$ is given
\item Forcing terms like $\begin{pmatrix} t \\ 0 \end{pmatrix} or \begin{pmatrix} $e^{t}$ \\ $e^{-t}$ \end{pmatrix}$
\item Verification that a given function is a particular solution
\item Initial value problems requiring both $\mathbf{x}_{h}$ and $\mathbf{x}_{p}$
\end{itemize}
\end{examtip}

\section{Connection to Single Equations}

For a single $n$-th order equation converted to a system:
\[y^{(n)} + a_{n-1}y^{(n-1)} + \cdots + a_{0y} = f(t)\]

The companion matrix form gives:
\[\mathbf{x}' = \begin{pmatrix}
0 & 1 & 0 & \cdots & 0 \\
0 & 0 & 1 & \cdots & 0 \\
\vdots & \vdots & \vdots & \ddots & \vdots \\
0 & 0 & 0 & \cdots & 1 \\
-a_{0} & -a_{1} & -a_{2} & \cdots & -a_{n-1}
\end{pmatrix}\mathbf{x} + \begin{pmatrix} 0 \\ 0 \\ \vdots \\ 0 \\ f(t) \end{pmatrix}\]

The variation of parameters formula for systems then recovers the scalar variation formula!

\end{document}